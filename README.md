# rucsaxslib

- [Installation](#installation)
  - [Manual installation](#manual-installation)
  - [From TestPyPI](#from-testpypi)
- [Overview](#Overview)
- [Example usage](#example-usage)

## Introduction

`rucsaxslib` is a Python package intended for treatment of 2D X-ray scattering data.
While the library is designed to be generally applicable, it has only been tested on data from the [Xeuss3](https://www.xenocs.com/saxs-products/saxs-equipment-xeuss) installed at Roskilde University (RUC).

While I consider the library in a functional state, its primary purpose is to clarify how data reduction is done in practice.
Image operations are performed only using the standard Python library and [NumPy](https://numpy.org/).
I thus recommend reading through the code, in partcular [img.py](src/rucsaxslib/img.py).

## Installation

### Manual installation

Clone this respository and run `pip install -e rucsaxslib` in an appropriate virtual environment.

### From TestPyPI

Currently resides at <https://test.pypi.org/project/rucsaxslib/>.

```
pip install numpy matplotlib fabio
pip install --index-url https://test.pypi.org/simple/ --no-deps rucsaxslib
```

## Overview

`rucsaxslib` exposes the following functions on import:

- `rucsaxslib.ImgData`: Class that holds detector data
- `rucsaxslib.from_rucsaxs`: Read an image file from Xeuss3 and return an `ImgData` object.
- `rucsaxslib.integrate`: Integrate an image onto a single axis (typically $q$ or $2\theta$)
- `rucsaxslib.gi_integrate`: Integrate GISAXS images along $q_{xy}$ or $q_z$
- `rucsaxslib.gi_draw_bbox`: Draw the bounding box used by `gi_integrate`.
- `rucsaxslib.reflectivity`: Get reflectivity curve from a list of images.
- `rucsaxslib.stva`: Functions to parse data from the Solvent Thermal Vapor Annealing (STVA) setup used at RUC.
- `rucsaxslib.xeuss`: Functions to parse plaintext data generated by Xeuss3.

Run `help()` on any of these objects from a Python prompt for details.

## Detector Data
Detector data is stored in `ImgData` objects.
`ImgData` objects are initialized by passing the raw detector counts (numpy array) and header information (dictionary).
In order for data reduction to work properly, there are a number of keys in the header that are required (such as sample-detector distance).
These keywords are listed in [Required keywords](#required-keywords).

When working with data from the rucsaxs laboratory, the helper function `from_rucsaxs` takes care of loading the image file and setting the required keywords.
In practice, one loads an image (in this case a file named `data.edf`) by running the following:

```python
import rucsaxslib as rs
img = rs.from_rucsaxs('data.edf')
```

This loads the raw image data that can be accessed from the `img.data` attribute.
Header information is saved in the `img.header` attribute and the standard error for each pixel is saved in the `img.error` attribute.
To perform all standard corrections to the pixel intensities (time, flux, transmission, solid angle and polarization), run

```python
import rucsaxslib as rs
img = rs.from_rucsaxs('data.edf', corrs='all')
```

`ImgData` objects contain a number of useful methods:

- `ImgData.apply_corrections`: Corrects data and error in order to the differential scattering cross-section for each pixel.
  As shown above, this can be run when initializing the object through the `corrs` keyword argument.
- `ImgData.get_coordinates`: Get coordinates of each pixel in various reference systems.
- `ImgData.get_q`: Get the magnitude of $q$ (in inverse angstrom) for each pixel.
- `ImgData.get_tth`: Get the scattering angle $2\theta$ (in degrees) for each pixel.
- `ImgData.plot`: Plot the detector image using [Matplotlib](https://matplotlib.org/).

For details see the docstring of each method.

## Plaintext Data

## Integration

## GISAXS

## STVA

## Required keywords

## Example usage

Plot detector image in laboratory coordinates (distance from Point of Normal Incidence).

```python
import rucsaxslib as rs
img = rs.from_rucsaxs('data.edf')
img.plot()
plt.show()
```

Plot detector image in polar coordinates. Rebinning is needed to avoid artifacts from `pcolormesh`.

```python
import rucsaxslib as rs
img = rs.from_rucsaxs('data.edf')
img.plot(coords='polar', rebin=300) # 300 bins in both angular directions
plt.show()
```
